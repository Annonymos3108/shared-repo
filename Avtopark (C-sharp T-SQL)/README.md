# Курсовая работа. Тема: Разработка и реализация базы данных

## Задание на курсовую работу

Спроектировать базу данных, построить программу, обеспечивающую взаимодействие с ней в режиме диалога, для диспетчера автобусного парка. В БД хранятся сведения о водителях, маршрутах автобусов и их характеристиках. 
Каждый водитель характеризуется: ФИО, классом, стажем работы и окладом, причем оклад зависит от его класса и стажа работы. 
Маршрут автобуса характеризуется: номером маршрута, временем начала и конца движения, интервалом движения и протяженностью. 
Характеристиками автобусов являются: номер автобуса, его тип и вместимость, причем вместимость автобуса зависит от его типа. 
Каждый водитель закреплен за отдельным автобусом, а каждый автобус закреплен за определенным маршрутом. Необходимо предусмотреть возможность корректировки БД в случаях поступления на работу нового водителя, списывания старого автобуса, введения нового или изменения старого маршрута и т.п. 

Диспетчеру автопарка могут потребоваться следующие сведения: 

- список водителей, работающих на определенном маршруте; 
- номера автобусов, обслуживающих данный маршрут 
- когда начинается или заканчивается движение автобусов на всех или отдельных маршрутах; 
- какова протяженность всех или определенных маршрутов автобусов; 
- на каких автобусах работает водитель. 
Диспетчер может вносить следующие изменения: 
- прием на работу нового водителя; 
- списание старого автобуса; 
- изменение протяженности маршрута. 

Необходимо предусмотреть возможность выдачи справки о протяженности маршрута и отчета по автопарку (количество автобусов и их тип, номера маршрутов, время начала движения и интервал, ФИО водителей и их класс).



## Аннотация

База данных «Автобусный парк» предназначена для диспетчера автопарка и обеспечивает в режиме диалога доступ к информации о водителях автопарка, маршрутах, автобусах, а также рабочих сменах водителей. Предусмотрена возможность как внесения изменений, так и получения справок с выводом информации на документ MS Word. Также БД позволяет выводить сведения о количестве автобусов в автопарке, окладе водителей с автоматическим расчетом в зависимости от стажа, а также другую полезную информацию.
База данных функционирует с ядром базы данных Microsoft SQL (Transact-SQL) с интерфейсом Windows Forms на C# (Microsoft .NET Framework). 

## Краткое описание алгоритмов решения задач

Хранение информации о водителях, маршрутах, автобусах и сменах водителей.
Информация о водителях, маршрутах, автобусах и сменах храниться в 6 связанных (по внешним ключам) таблицах, связи организованы таким образом, чтобы обеспечить корректную работу системы (более подробное описание приведено в 5-ом разделе) и целостность базы данных. Например, чтобы уволить водителя (удалить данные водителя с базы данных), надо сначала снять водителя со всех смен. Такое ограничение не позволяет появления ситуации, когда смена поставлена, а водителя нет (его уволили).

Печать справок о протяженности маршрута и отчета по автопарку. Для печати справок используется запрос к базе данных, а с полученными данными создается MS Word документ и заполняется (подробное описание приведено в 5-ом разделе).

Для реализации курсового проекта я выбрал СУБД Microsoft SQL Server 2019. Microsoft SQL Server 2019 — система управления реляционными базами данных (РСУБД), разработанная корпорацией Microsoft. Основной используемый язык запросов — Transact-SQL (T-SQL). T-SQL является реализацией стандарта ANSI/ISO по структурированному языку запросов (SQL) с расширениями. Используется для работы с базами данных размером от персональных до крупных баз данных масштаба предприятия; конкурирует с другими СУБД в этом сегменте рынка.


## Функции управлвния данными

### Хранение (создание информационных объектов)

Информационные объекты:

```tsql
CREATE TABLE [dbo].[Автобусы] (
    [Автобус] NVARCHAR (6)  NOT NULL,
    [Тип]     NVARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([Автобус] ASC) 
)
GO

CREATE TABLE [dbo].[Водители] (
    [Паспорт] VARCHAR (11)  NOT NULL,
    [ФИО]     NVARCHAR (50) NOT NULL,
    [Оклад]   INT     NOT NULL,
    [Стаж]    INT           NOT NULL,
    [Класс]   NCHAR (5)     NOT NULL,
    PRIMARY KEY CLUSTERED ([Паспорт] ASC)
)
GO

CREATE TABLE [dbo].[Оклад] (
    [Класс] NCHAR (5) NOT NULL,
    [Оклад] NCHAR (6) NOT NULL,
    PRIMARY KEY CLUSTERED ([Класс] ASC)
)
GO

CREATE TABLE [dbo].[Водят] (
    [id_Водителя] INT           IDENTITY (1, 1) NOT NULL,
    [Паспорт]     VARCHAR (11)  NOT NULL,
    [Автобус]     NVARCHAR (6)  NOT NULL,
    [ФИО]         NVARCHAR (50) NOT NULL,
    [Маршрут]     INT           NOT NULL,
    [Дата]        DATE          NOT NULL,
    PRIMARY KEY CLUSTERED ([id_Водителя] ASC)
)
GO

CREATE TABLE [dbo].[Маршруты] (
    [Маршрут]                  INT           NOT NULL,
    [Начальный_пункт]          NVARCHAR (25) NOT NULL,
    [Конечный_пункт]           NVARCHAR (25) NOT NULL,
    [Время_начала_движения]    TIME (7)      NOT NULL,
    [Время_окончания_движения] TIME (7)      NOT NULL,
    [Интервал(мин)]            INT           NOT NULL,
    [Протяженность(мин)]       INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([Маршрут] ASC)
)
GO

CREATE TABLE [dbo].[Списанные_автобусы] (
    [Автобус] NVARCHAR (6)  NOT NULL,
    [Тип]     NVARCHAR (20) NOT NULL,
    [Дата]    DATE          NOT NULL,   
    PRIMARY KEY CLUSTERED ([Автобус] ASC) 
)
GO

CREATE TABLE [dbo].[Тип_вместимость] (
    [Тип]               NVARCHAR (20) NOT NULL,
    [Вместимость(мест)] INT           NOT NULL, 
    CONSTRAINT [PK_Тип_вместимость] PRIMARY KEY ([Тип])
)
GO
```

###	Манипулирование (добавление, изменение, удаление, поиск данных)

Для изначального добавления данных в базу использовались запросы SQL, пример запроса:

```tsql
INSERT INTO Оклад(Класс,Оклад) VALUES('A', 10000)
INSERT INTO Тип_вместимость VALUES(N'малый',40)
INSERT INTO Маршруты VALUES(1, N'Наличная ул.', N'Новосибирская ул.', '06:00:00','00:00:00', 30, 85)
INSERT INTO Автобусы(Автобус, Тип) VALUES(N'р258ол', N'малый')
INSERT INTO Водители(Паспорт, ФИО, Класс, Стаж, Оклад) VALUES('2888 108232', N'Кондратьев Роман Тимурович', 'C', 3, 23000)
INSERT INTO Водят(Паспорт, Автобус, ФИО, Маршрут, Дата) VALUES('6502 104936', N'п528чт', N'Михеев Власий Ефимович', 1, '2020-10-19')
```

Для добавления данных из интерфейса программы используются параметризированное запросы. Для приема нового водителя на работу его данные заносятся в базу данных следующим запросом:

```tsql
INSERT INTO [Водители] (Паспорт, ФИО, Оклад, Класс, Стаж)
VALUES(@Паспорт, @ФИО, @Оклад, @Класс, @Стаж)
```

С помощью встроенных средств языка C# вместо параметров `@Паспорт`, `@ФИО`, `@Класс`, `@Стаж` подставляются соответствующие данные из определенных текстовых полей из интерфейса программы. Учитывая стаж и класс работы водителя считается оклад, подставляются параметры и выполняется запрос.

## Создание MS Word документов 

Создание MS Word документов происходит в несколько этапов. Сначала выполняется запрос в базу, для получения нужных данных:

```tsql
SELECT [Протяженность(мин)]
FROM [Маршруты]
WHERE [Маршрут] = @Маршрут
```

где `@Маршрут` принимает значение поля `«№»`. Затем открывается MS Word, создается новый документ и включается отображение окна MS Word. 

```csharp
Word._Application oWord;
Word._Document oDoc;
oWord = new Word.Application();
oWord.Visible = true;
```

Далее начинается передача текста в MS Word и его форматирование (в данном случае: жирный, , интервал после строки 6пт, выровнен по центру, перевод строки).

```csharp
Word.Paragraph oPara1;
oPara1 = oDoc.Content.Paragraphs.Add(ref oMissing);
oPara1.Range.Text = "ООО \"АВТОПАРК ПРИКОЛОВ\"";
oPara1.Range.Font.Bold = 1;
oPara1.Format.SpaceAfter = 6;
oPara1.Range.ParagraphFormat.Alignment = 
Word.WdParagraphAlignment.wdAlignParagraphCenter;
oPara1.Range.InsertParagraphAfter();
```

Аналогичными средствами строится остальная часть документа.
В разделе «Справки и отчеты» есть возможность генерации полного отчета по автопарку (количество автобусов и их тип, номера маршрутов, время начала движения и интервал, ФИО водителей и их класс). До генерации полного отчета выполняются множество запросов по базе, все данные нужные данные собираются, потом создается документ. 